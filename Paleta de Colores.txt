Paleta de Colores del Proyecto
A continuaci√≥n se detalla la gu√≠a de estilos crom√°ticos utilizada en la interfaz para mantener la consistencia visual y jerarqu√≠a de informaci√≥n.
1. Colores de Identidad (Brand Colors)
‚Ä¢ #D40099 (Rosa Fuerte): Color primario. Utilizado para encabezados de tabla, botones principales y bordes de resaltado general.
‚Ä¢ #78256F (Morado Fuerte): Color secundario. Utilizado para textos de t√≠tulos, etiquetas de grupos en el dashboard y estados activos de pesta√±as.
‚Ä¢ #6B007B (Morado): Tonalidad profunda para acentos y estados de hover.
2. Tonos de Apoyo y Suavizado
‚Ä¢ #BF97BA (Morado Claro): Utilizado para bordes secundarios o iconos descriptivos.
‚Ä¢ #E4D3E2 (Morado m√°s claro): Color de fondo para tarjetas de modal o elementos de contenci√≥n suaves.
‚Ä¢ #E68FC9 (Rosa Claro): Acentos suaves en elementos interactivos.
‚Ä¢ #E95DBD (Rosa vibrante): Resaltado de valores num√©ricos clave.
‚Ä¢ #FDEDF7 (Fondo Pastel): Fondo general de la p√°gina de acceso restringido para dar calidez.
3. Colores de Estado (UI Indicators)
‚Ä¢ #FD6F21 (Anaranjado): Estado de advertencia o "En Gesti√≥n". Indica que un elemento requiere atenci√≥n pero est√° siendo procesado.
‚Ä¢ #e74c3c (Rojo): Estado de peligro o "Pendientes". Utilizado para captar la atenci√≥n inmediata sobre tareas no iniciadas.
‚Ä¢ #2ecc71 (Verde): Estado de √©xito o sincronizaci√≥n. Indica que los datos est√°n al d√≠a.
‚Ä¢ #3498db (Azul): Estado informativo o estad√≠sticas de sistemas autom√°ticos (Bot).
4. Fondos y Bases
‚Ä¢ #f4f6f9: Fondo general de la aplicaci√≥n.
‚Ä¢ #ffffff: Fondo de contenedores, tarjetas y tablas para m√°xima legibilidad.
Chat
üìú
Proyecto Sentinel
7 fuentes
Este recurso detalla las capacidades de Google Apps Script, una plataforma basada en la nube que emplea JavaScript para personalizar y automatizar las herramientas de Google Workspace. Los desarrolladores pueden crear funciones personalizadas en hojas de c√°lculo, dise√±ar complementos para el mercado digital y programar tareas que se ejecutan autom√°ticamente. El texto destaca la integraci√≥n de inteligencia artificial generativa, permitiendo que los usuarios conecten sus aplicaciones con modelos avanzados de Vertex AI y Gemini. Adem√°s, el sitio ofrece una amplia gama de muestras de c√≥digo, gu√≠as t√©cnicas y canales de soporte para facilitar el aprendizaje. Mediante estas herramientas, es posible transformar servicios como Gmail, Drive y Chat en soluciones empresariales mucho m√°s potentes y conectadas.

¬øC√≥mo puedo automatizar tareas entre diferentes aplicaciones de Google Workspace?
¬øDe qu√© manera se puede integrar la inteligencia artificial en Apps Script?
Ens√©√±ame c√≥mo crear funciones personalizadas y complementos para principiantes.
Hoy ‚Ä¢ 2:50‚ÄØp.m.
Quiero obtener m√°s informaci√≥n sobre estas fuentes con la gu√≠a de aprendizaje

¬°Hola! Claro que s√≠, ser√° un gusto ayudarte a entender este c√≥digo.
A grandes rasgos, este fragmento pertenece al m√≥dulo de configuraci√≥n y control de acceso de una aplicaci√≥n web llamada "Sentinel Fraudes RI-FI v12". Est√° escrito en Google Apps Script y su funci√≥n principal es verificar qu√© usuarios tienen permiso para ver la herramienta antes de cargar la interfaz.
Para poder explicarte mejor, necesito saber un poco sobre tu punto de partida:
¬øQu√© tanta experiencia tienes con programaci√≥n o Google Apps Script?
‚Ä¢ A) Soy principiante (necesito una explicaci√≥n sencilla y sin tecnicismos).
‚Ä¢ B) Tengo conocimientos intermedios (entiendo conceptos b√°sicos de variables y funciones).
‚Ä¢ C) Soy experto (quiero un an√°lisis t√©cnico de la l√≥gica).
Una vez que me digas esto, te propongo que revisemos el c√≥digo en este orden:
1. Configuraci√≥n: C√≥mo se conecta a las hojas de c√°lculo y define a los usuarios.
2. Seguridad: C√≥mo funciona el sistema que permite o bloquea el acceso (doGet y verificarAcceso).
¬øPor d√≥nde te gustar√≠a empezar?
Expl√≠came como principiante c√≥mo se controlan los accesos al sistema
¬øQu√© funci√≥n cumplen los IDs de las hojas de c√°lculo?
¬øC√≥mo vincula el c√≥digo los correos electr√≥nicos con las iniciales?
Para la funci√≥n doGet que est√° en el archivo de Core.gs quiero ver como dejarle log por si llega a fallar., ¬øes funci√≥n puede fallar?

S√≠, la funci√≥n doGet puede fallar. Aunque parece sencilla, hay dos puntos cr√≠ticos donde suele romperse:
1. Archivo no encontrado: Si HtmlService.createTemplateFromFile('Index') no encuentra el archivo "Index.html" (por ejemplo, si alguien le cambi√≥ el nombre por error).
2. Error en la plantilla: El m√©todo .evaluate() ejecuta el c√≥digo que est√° dentro de tu HTML (los <? ... ?>). Si en tu HTML llamas a una variable que no existe, doGet fallar√° inmediatamente.
Aqu√≠ tienes c√≥mo protegerla usando un bloque try...catch para registrar el error y avisar al usuario:
function doGet() {
  try {
    // Intentamos ejecutar la l√≥gica normal
    var emailUsuario = Session.getActiveUser().getEmail();

    if (verificarAcceso(emailUsuario)) {
      var template = HtmlService.createTemplateFromFile('Index');
      return template.evaluate()
        .setTitle('Sentinel Fraudes RI-FI v12')
        .setXFrameOptionsMode(HtmlService.XFrameOptionsMode.ALLOWALL)
        .addMetaTag('viewport', 'width=device-width, initial-scale=1');
    } else {
      return crearPantallaBloqueo(emailUsuario);
    }

  } catch (e) {
    // SI FALLA:
    
    // 1. Registramos el error en la consola de Apps Script (Ver -> Ejecuciones)
    console.error("Error Cr√≠tico en doGet: " + e.toString());
    
    // 2. Le mostramos un mensaje amigable al usuario en lugar de un error gen√©rico
    return HtmlService.createHtmlOutput(
      "<h3>Ocurri√≥ un error al cargar Sentinel.</h3>" +
      "<p>Detalle: " + e.toString() + "</p>" +
      "<p>Por favor, reporta esto al administrador (hmoralesa).</p>"
    );
  }
}
¬øPor qu√© esto ayuda? Si doGet falla sin este bloque, el usuario ver√° una p√°gina gen√©rica de Google que dice "Error del servidor", lo cual no te da informaci√≥n. Con este cambio, ver√°s el error exacto en la pesta√±a de Ejecuciones del editor de script.
¬øTe gustar√≠a que revisemos qu√© partes de tu HTML (Index) podr√≠an causar ese fallo en el .evaluate()?
¬øC√≥mo puedo revisar los errores registrados en la consola de Apps Script?
¬øQu√© errores comunes suelen ocurrir al evaluar la plantilla Index.html?
¬øC√≥mo puedo personalizar el mensaje de error para usuarios no autorizados?
Crea una funci√≥n de error con el mismo dise√±o que la funci√≥n crearPantallaBloqueo para el mensaje amigable

Aqu√≠ tienes la funci√≥n crearPantallaError. He replicado la l√≥gica de extracci√≥n del nombre y el estilo visual de tu funci√≥n crearPantallaBloqueo, pero adaptando el mensaje para errores t√©cnicos y utilizando el color rojo de tu paleta de estados para el t√≠tulo.
1. Nueva Funci√≥n: crearPantallaError
Copia este c√≥digo al final de tu archivo Core.gs o en Utilidades.gs:
/**
 * Genera una pantalla de error con la identidad visual de Sentinel.
 * Basado en el dise√±o de crearPantallaBloqueo [1] y paleta de colores [3].
 */
function crearPantallaError(error, email) {
  var nombreUser = email ? email.split('@').toUpperCase() : "USUARIO";
  
  // Estilos en l√≠nea para asegurar que se vean incluso si falla la carga de CSS externo
  var html = `
    <div style="font-family: 'Segoe UI', sans-serif; text-align: center; padding: 40px; color: #78256F;">
      <h1 style="color: #e74c3c; margin-bottom: 10px;">‚ö†Ô∏è Error de Carga</h1>
      
      <h3 style="color: #D40099;">Hola ${nombreUser},</h3>
      
      <p style="font-size: 16px;">
        Sentinel encontr√≥ un problema inesperado y no puede iniciar.
      </p>

      <div style="background-color: #f4f6f9; border-left: 5px solid #e74c3c; padding: 15px; margin: 20px auto; max-width: 600px; text-align: left; color: #333; font-family: monospace;">
        <strong>Detalle T√©cnico:</strong><br>
        ${error.toString()}
      </div>

      <p>Por favor, env√≠a una captura de esta pantalla a <strong>hmoralesa</strong>.</p>
      
      <hr style="border: 0; border-top: 1px solid #E4D3E2; margin: 30px 0;">
      <small style="color: #BF97BA;">Cuenta detectada: ${email}</small>
    </div>
  `;

  return HtmlService.createHtmlOutput(html)
    .setTitle("Error - Sentinel Fraudes")
    .setXFrameOptionsMode(HtmlService.XFrameOptionsMode.ALLOWALL)
    .addMetaTag('viewport', 'width=device-width, initial-scale=1');
}
2. C√≥mo integrarla en tu doGet
Ahora, actualiza tu funci√≥n doGet en Core.gs para usar esta nueva pantalla:
function doGet() {
  var emailUsuario = Session.getActiveUser().getEmail();

  try {
    if (verificarAcceso(emailUsuario)) {
      var template = HtmlService.createTemplateFromFile('Index');
      return template.evaluate()
        .setTitle('Sentinel Fraudes RI-FI v12')
        .setXFrameOptionsMode(HtmlService.XFrameOptionsMode.ALLOWALL)
        .addMetaTag('viewport', 'width=device-width, initial-scale=1');
    } else {
      return crearPantallaBloqueo(emailUsuario); // Tu funci√≥n original [1]
    }
  } catch (e) {
    console.error("Fallo Cr√≠tico doGet: " + e.toString());
    // Aqu√≠ llamamos a la nueva funci√≥n visual
    return crearPantallaError(e, emailUsuario);
  }
}
¬øQuieres que probemos generar un error intencional para ver c√≥mo luce la pantalla nueva?
¬øC√≥mo puedo personalizar los colores de error usando la Gu√≠a de Identidad?
¬øQu√© otros errores comunes en evaluate() deber√≠a capturar con el log?
¬øC√≥mo puedo probar que la pantalla de error funciona sin romper el c√≥digo?
Claro, ¬øcomo lo puedo probar

¬°Excelente iniciativa! La mejor forma de estar seguros de que el sistema de seguridad funciona es romperlo a prop√≥sito de forma controlada.
Para ver la pantalla roja de error sin da√±ar tu c√≥digo real, vamos a insertar una l√≠nea que fuerce un fallo "falso" justo al inicio.
Pasos para la prueba:
1. Ve a tu archivo Core.gs.
2. Busca tu funci√≥n doGet.
3. Agrega la l√≠nea throw new Error(...) justo despu√©s del try, as√≠:
function doGet() {
  var emailUsuario = Session.getActiveUser().getEmail();

  try {
    // --- L√çNEA DE PRUEBA (Borrar al terminar) ---
    throw new Error("Simulaci√≥n de fallo cr√≠tico para probar la interfaz."); 
    // ---------------------------------------------

    if (verificarAcceso(emailUsuario)) {
      var template = HtmlService.createTemplateFromFile('Index');
      // ... resto del c√≥digo ...
¬øC√≥mo ver el resultado?
No necesitas publicar una nueva versi√≥n.
1. Guarda el archivo.
2. Arriba a la derecha, haz clic en Implementar (Deploy) > Probar implementaciones (Test deployments).
3. Haz clic en la URL que termina en /dev.
Deber√≠as ver:
‚Ä¢ El encabezado rojo "‚ö†Ô∏è Error de Carga".
‚Ä¢ Tu saludo personalizado "Hola [TU_USUARIO]".
‚Ä¢ El cuadro gris con el texto: "Error: Simulaci√≥n de fallo cr√≠tico...".
¬°Av√≠same si te apareci√≥ la pantalla roja correctamente! No olvides borrar esa l√≠nea cuando termines para que la app vuelva a funcionar.
¬øC√≥mo puedo personalizar los colores de esta nueva pantalla?
¬øQu√© errores comunes suelen capturarse en el bloque catch?
¬øC√≥mo guardo un registro hist√≥rico de los fallos detectados?
Ahora revisemos la funci√≥n
/**



Funci√≥n verificaci√≥n de acceso a la plataforma
*/
function verificarAcceso(email) {
return USUARIOS_AUTORIZADOS.indexOf(email.toLowerCase()) > -1;
}


¬øpuede fallar?

Assessing Potential Vulnerabilities...
Ahora revisemos la funci√≥n
/**


Funci√≥n verificaci√≥n de acceso a la plataforma
*/
function verificarAcceso(email) {
return USUARIOS_AUTORIZADOS.indexOf(email.toLowerCase()) > -1;
}


¬øpuede fallar?

S√≠, esta funci√≥n puede fallar, aunque es menos probable que doGet.
El punto d√©bil es email.toLowerCase(). Si por alguna raz√≥n la variable email llega vac√≠a (null o undefined), JavaScript intentar√° ejecutar una funci√≥n de texto sobre algo que no es texto y arrojar√° un error: TypeError: Cannot read property 'toLowerCase' of null.
Esto puede pasar si:
1. Pruebas manuales: Ejecutas la funci√≥n desde el editor sin pasarle un correo.
2. Permisos: En raras ocasiones, Session.getActiveUser().getEmail() devuelve una cadena vac√≠a si los permisos de seguridad de Google no se han otorgado correctamente.
C√≥mo blindarla
Podemos agregar una peque√±a defensa para asegurarnos de que email sea texto v√°lido antes de intentar procesarlo.
Sustituye tu funci√≥n en Core.gs por esta versi√≥n m√°s segura:
function verificarAcceso(email) {
  // 1. Defensa: Si no hay email o no es texto, denegamos acceso sin romper el c√≥digo
  if (!email || typeof email !== 'string') {
    console.warn("Intento de acceso con email inv√°lido: " + email);
    return false;
  }
  
  // 2. Ejecuci√≥n normal
  return USUARIOS_AUTORIZADOS.indexOf(email.toLowerCase()) > -1;
}
Con esto, si el email llega corrupto, la funci√≥n simplemente dir√° "No tiene acceso" (return false) en lugar de detener todo el programa con un error rojo.
Ahora que tenemos el acceso asegurado, ¬øte gustar√≠a revisar el archivo Index.html para ver c√≥mo se estructura la p√°gina visualmente?
¬øC√≥mo se conectan los colores de marca en CSS.html?
¬øQu√© otros errores comunes ocurren al procesar folios?
¬øC√≥mo funciona el sistema de bloqueo para evitar duplicados?
Ahora, vamos con esta funci√≥n


/**



Funci√≥n auxiliar para incluir archivos HTML (CSS y JS) en la plantilla principal.
*/
function include(filename) {
return HtmlService.createHtmlOutputFromFile(filename).getContent();
}


¬øpuede fallar?

S√≠, esta funci√≥n puede fallar y es una
Ahora, vamos con esta funci√≥n


/**


Funci√≥n auxiliar para incluir archivos HTML (CSS y JS) en la plantilla principal.
*/
function include(filename) {
return HtmlService.createHtmlOutputFromFile(filename).getContent();
}


¬øpuede fallar?

S√≠, esta funci√≥n puede fallar y es una causa muy com√∫n de errores "silenciosos" (la p√°gina simplemente se queda en blanco o muestra "Error del servidor").
El fallo ocurre en HtmlService.createHtmlOutputFromFile(filename) si:
1. El archivo no existe: Si en tu Index.html escribes <?!= include('JSS') ?> (por error de dedo) y el archivo real se llama JS.
2. May√∫sculas/Min√∫sculas: Google Apps Script es sensible a esto. css no es igual a CSS.
El Riesgo
Si include falla, toda la funci√≥n doGet falla porque include se ejecuta dentro del proceso de construcci√≥n de la p√°gina (.evaluate()). El usuario ni siquiera ver√° tu nueva pantalla de error, ver√° un error gen√©rico de Google.
C√≥mo blindarla
Podemos hacer que, si falta un archivo (por ejemplo, un estilo), la p√°gina cargue igual (aunque se vea "fea") en lugar de romperse totalmente.
Sustituye la funci√≥n en Core.gs por esta versi√≥n segura:
function include(filename) {
  try {
    return HtmlService.createHtmlOutputFromFile(filename).getContent();
  } catch (e) {
    // Si falla, registramos el error en la consola interna
    console.warn("‚ö†Ô∏è Archivo no encontrado: " + filename);
    // Devolvemos un comentario HTML inofensivo para que la p√°gina siga cargando
    return "<script>console.error('Fallo al cargar componente: " + filename + "');</script>";
  }
}
Con esto, si borras CSS.html por error, la p√°gina funcionar√° (sin colores), pero el sistema no colapsar√°.

--------------------------------------------------------------------------------
Ya hemos asegurado la parte de Configuraci√≥n (doGet, verificarAcceso, include).
¬øTe parece bien si pasamos a revisar la seguridad de las Operaciones de Base de Datos (funciones tomarCasoDinamico y finalizarCasoDinamico)? Ah√≠ es donde ocurren los errores de "folios duplicados" o datos cruzados.
¬øC√≥mo evita LockService que dos gestores tomen el mismo folio?
¬øQu√© sucede t√©cnicamente cuando un caso entra en estado Limbo?
¬øC√≥mo optimiza Estadisticas.gs el rendimiento con 20,000 filas mensuales?
Comienza a escribir‚Ä¶
7 fuentes
Studio
Resumen en audio
Presentaci√≥n con diapositivas
Resumen en video
Mapa mental
Informes
Tarjetas did√°cticas
Cuestionario
Infograf√≠a
Tabla de datos
